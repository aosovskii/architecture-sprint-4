### Мотивация

1. Повышение прозрачности и контроля

```   
Мониторинг позволяет получать оперативную информацию о состоянии системы в реальном времени. Это дает команде
разработчиков и DevOps инженерам возможность отслеживать ключевые метрики.

Выгода:
Повышается прозрачность работы системы, позволяет быстрее выявлять и устранять проблемы, снижая риск
простоя и сбоев.
```

2. Раннее обнаружение проблем

```
Инструменты мониторинга дают возможность отслеживать аномалии и отклонения от эталонного поведения системы. Что
позволяет обнаруживать потенциальные проблемы на ранней стадии.

Выгода:
Раннее обнаружение проблем позволяет своевременно реагировать на них, что снижает риск простоя и ущерба для
бизнеса.
```

3. Оптимизация производительности

```
Мониторинг предоставляет данные о производительности системы, это позволяет выявлять узкие места и
неэффективные компоненты.

Выгода: 
Повышение производительности системы, это приводит к более быстрой обработке запросов и улучшению
пользовательского опыта.
```

4. Улучшение отказоустойчивости

```
Мониторинг позволяет отслеживать состояние критических компонентов системы и реагировать на их сбои, что
помогает быстро восстанавливать работоспособность системы, в случае отказа.

Выгода: 
Повышается отказоустойчивость системы, что снижает риск простоя и ущерба для бизнеса.
```

5. Снижение затрат на обслуживание

```
   Мониторинг позволяет автоматизировать процессы обнаружения и устранения проблем, это снижает нагрузку на
техническую поддержку и разработчиков.

Выгода:
Снижаются затраты на обслуживание системы, так как автоматизация позволяет быстрее и эффективнее решать проблемы.
```

6. Улучшение планирования и принятия решений

```
Мониторинг предоставляет данные о нагрузке на систему, использовании ресурсов и других метриках. Эти
данные можно использованы для планирования масштабирования, оптимизации инфраструктуры и принятия других решений.

Выгода: 
Повышается эффективность планирования и принятия решений, это позволяет более гибко реагировать на
изменения рынка и потребности бизнеса.
```

7. Повышение удовлетворенности клиентов

```
Мониторинг позволяет быстро реагировать на проблемы, связанные с производительностью и доступностью сервисов, что 
обеспечивает более стабильную и надежную работу системы.

Выгода: 
Повышается удовлетворенность клиентов, это может стать толчком к увеличению лояльности и росту продаж.
```

### Выбор подхода к мониторингу

Customer Process:

- Подход: RED (Response time, Errors, Duration)

- ОБоснование: Отлично подходит для мониторинга пользовательских интерфейсов и взаимодействий, так как важно измерять время отклика, количество ошибок и продолжительность операций.

Seller Process:

- Подход: USE (Utilization, Saturation, Errors)

- ОБоснование: Подходит для мониторинга ресурсов и производительности, так как процесс продавца "involves resource-intensive" operations.

API user Process:

- Подход: Four Golden Signals (Latency, Traffic, Errors, Saturation)

- ОБоснование: Подходит для мониторинга API-сервисов, так как важно отслеживать задержки, трафик, ошибки и насыщение ресурсов.

Operator Process:

- Подход: USE (Utilization, Saturation, Errors)

- ОБоснование: Подходит для мониторинга операторских процессов, особенно если они связаны с обработкой данных и производительностью.

Internal Shop:

- Подход: Four Golden Signals (Latency, Traffic, Errors, Saturation)

- ОБоснование: Подходит для мониторинга внутреннего магазина, особенно если он является микросервисом с высоким трафиком и потребностью в отслеживании задержек и ошибок.

CRM:

- Подход: USE (Utilization, Saturation, Errors)

- ОБоснование: Подходит для мониторинга CRM-системы, так как важно отслеживать использование ресурсов и насыщение системы.

MEG API:

- Подход: Four Golden Signals (Latency, Traffic, Errors, Saturation)

- ОБоснование: Подходит для мониторинга API, так как он предоставляет услуги по работе с заказами и нуждается в отслеживании задержек и трафика.

Shop API:

- Подход: Four Golden Signals (Latency, Traffic, Errors, Saturation)

- ОБоснование: Подходит для мониторинга API магазина, так как важно отслеживать задержки, трафик, ошибки и насыщение ресурсов.

CRM API:

- Подход: Four Golden Signals (Latency, Traffic, Errors, Saturation)

- ОБоснование: Подходит для мониторинга API CRM, так как важно отслеживать задержки, трафик, ошибки и насыщение ресурсов.

3d files storage:

- Подход: USE (Utilization, Saturation, Errors)

- ОБоснование: Подходит для мониторинга хранилища файлов, так как важно отслеживать использование хранилища и ошибки при доступе к файлам.

MEG db:

- Подход: USE (Utilization, Saturation, Errors)

- ОБоснование: Подходит для мониторинга базы данных, так как важно отслеживать использование ресурсов и насыщение системы.

Shop DB:

- Подход: USE (Utilization, Saturation, Errors)

- ОБоснование: Подходит для мониторинга базы данных магазина, так как важно отслеживать использование ресурсов и ошибки.

Messages Queue:

- Подход: Four Golden Signals (Latency, Traffic, Errors, Saturation)

- ОБоснование: Подходит для мониторинга очереди сообщений, отак как важно отслеживать задержки, трафик, ошибки и насыщение очереди.

### Какие метрики использовать

Мониторинг RabbitMQ:

Количество сообщений в dead-letter exchange

-    Цель: Определять сообщения, которые не могут быть обработаны, указывая на возможные ошибки потребителей.

-    Метки: Среда, Имя Exchange

Количество сообщений в пути

-    Цель: Мониторить текущую нагрузку на систему сообщений, чтобы предотвратить перегрузку.

-    Метки: Среда, Имя очереди

Мониторинг API (Shop API, CRM API, MES API)

Количество запросов в секунду (RPS)

-    Цель: Оценивать нагрузку на API, чтобы убедиться, что они могут справиться с demand.

-    Метки: Имя API, Конечная точка

Количество запросов на пользователя

-    Цель: Выявлять возможное неправильное использование или проблемы в приложении со стороны конкретных пользователей.

-    Метки: Имя API, ID пользователя

Загрузка ЦП и памяти

-    Цель: Предотвращать исчерпание ресурсов и выявляет нерациональное использование ресурсов кодом.

-    Метки: Имя API, ID экземпляра

Время отклика (задержка)

-    Цель: Уверенность в быстродействии и отклике сервиса для пользовательского опыта.

-    Метки: Имя API, Конечная точка

Мониторинг баз данных (Shop DB, MES DB)

Загрузка памяти

-    Цель: Мониторить память, которая может привести к проблемам производительности.

-    Метки: Экземпляр БД, ID экземпляра

Количество соединений

-    Цель: Убеждать, что базы данных не перегружены запросами на соединения.

-    Метки: Экземпляр БД, ID экземпляра

Мониторинг хранилищ

Размер хранилища S3, экземпляров Shop DB и MES DB

-    Цель: Управлять емкостью хранилища и планирует масштабирование.

-    Метки: Тип хранилища, ID экземпляра

Мониторинг HTTP статусных кодов

Количество HTTP 200 и 500

-    Цель: Оценивать состояние и надежность API.

-    Метки: Имя API, Конечная точка

Мониторинг сессий

Количество одновременных сессий

-    Цель: Понимать уровни конкуренции для масштабирования в пиковые периоды.

-    Метки: Имя API, Тип сессии

Мониторинг передачи данных

Килобайты переданные (полученные и отправленные)

-    Цель: Планировать пропускную способность и оптимизирует поток данных.

-    Метки: Имя API, Направление

Дополнительные метрики

Активные пользователи или сессии

-    Цель: Предоставлять контекст по паттернам использования.

-    Метки: Имя API, Тип пользователя

Длины очередей и время обработки в RabbitMQ

-    Цель: Убеждаться в эффективной обработке сообщений.

-    Метки: Имя очереди, Этап обработки

Синтетический мониторинг (тесты пинга)

-    Цель: Убеждаться в доступности и отклике API.

-    Метки: Имя API, Местоположение теста

Время работы и доступность

-    Цель: Убеждаться в доступности служб для пользователей.

-    Метки: Имя службы, Зона доступности

### План действий

**Выбор и настройка базы данных для временных рядов**

Следует для эффективного хранения и извлечения метрик мониторинга. Оптимальным выбором будет Prometheus,
который имеет открытую систему мониторинга и оповещения, благодаря егь масштабируемости и широким интеграциям.
Необходимо упредусмотреть горизонтальное масштабирование с помощью функции федерации Prometheus.

**Реализация _экспортёров_ для компонентов**

Для сбора метрик из разных компонентов системы следует развернуть _экспортёры_. Важно убедитьсяя, что
экспортёры правильно настрроены для expose метрик и отправляются в формате, совместимом с Prometheus.

**Настройка сбора данных**

Настьроить процессы сбора данных для получения соответствующих метрик. Настроить интервалы
сбора метрик и целевые объекты для каждого экспортёра. Обеспечить контроль целостности данных и убедитесь
в консистнетности по всем компонентам.

**Настройка alert'инга**

Для критических метрик важно установить правила оповещения и каналы нотификации. Как вариант, использовать Prometheus
Alertmanager для определения порогов оповещения и интеграции с существующими системами управления инцидентами. 
Важно определить четкие правила оповещеия и обеспечить своевременную маршрутизацию уведомлений.

**Создание визуализационных дашбордов**

Разработать пользовательские дашборды для визуализации метрик. Использовать Grafana для создания дашбордов, отображающих
ключевые метрики из базы данных временных рядов.

**Обеспечение масштабируемости и производительности**

ПОдготовиться к масштабированию системы мониторинга по мере роста инфраструктуры. Использовать функцию федерации Prometheus
для горизонтального масштабирования и обеспечить высокую производительность. 

**Реализация мер безопасности**

Обеспечениее безопасности системы мониторинга от несанкционированного доступа. Реализовать контроль доступа, шифрование
данных и безопасные механизмы аутентификации.